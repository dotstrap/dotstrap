#!/usr/bin/env ruby

require "thor"
require 'dotstrap'

class Cli < Thor
  # class_option "verbose", :type => :boolean, :desc => "Enable verbose output mode", :aliases => "-V"

  desc 'install REPO...', 'Download and configure specified GitHub repositories'
  long_desc <<-LONGDESC 
    Download/update & set up the configuration file(s) 
    to be loaded by the shell environment.

    Remember to add `source $XDG_CONFIG_HOME/config.{bash, zsh, fish}` 
    to your shell's startup file.

    Examples: 
      Downloads https://github.com/mkwmms/dotstrap-osx to
      #{Dotstrap.dotstrap_config_home}/mkwmms-dotstrap-osx and sets up the
      relevant configure files
      \x5> #{Dotstrap::NAME_EXE} install mkwmms/dotstrap-osx

       Downloads all the repositories from the file ~/.config/repos.txt (with the
      same repo format as above; each repo on a new line)  
      \x5> #{Dotstrap::NAME_EXE} install ~/.config/repos.txt
  LONGDESC
  def install(*args)
    repos = []
    args.each do |repo|
      if File.exist?(repo)
        File.open(repo).each do |line|
          repos << line.strip unless line.start_with?('#')
        end
      else 
        repos << repo
      end
    end
    Dotstrap::Configuration.new(repos).configure
  end 

  desc "uninstall REPO...", 'Remove specified GitHub repositories'
  long_desc 'Removes the shell configuration file(s) and lines from the source file from the given repository'
  def uninstall(*args)
    repos = []
    args.each do |repo|
      if File.exist?(repo)
        File.open(repo).each do |line|
          args << line.strip unless line.start_with?('#')
        end
      else 
        repos << repo
      end
    end
    Dotstrap::Configuration.new(repos).remove
  end

  desc "list [REPO...]", 'List file path and URL for currently installed specified GitHub repository (or all if none specified)'
  def list(*args)
    Dotstrap::Configuration.new(args).list
  end 
end

Cli.start(ARGV)
