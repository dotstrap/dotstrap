#!/usr/bin/env ruby

require 'dotstrap'

program :version, Dotstrap::VERSION
program :description, Dotstrap::DESCRIPTION

program :help, 'Author', "#{Dotstrap::AUTHOR} <#{Dotstrap::EMAIL}>"
program :help, 'Website', Dotstrap::HOMEPAGE
program :help_formatter, :compact

command :install do |c|
  c.syntax = 'dotstrap bundle [options]'
  c.summary = 'Bundle a specified GitHub repository'
  c.description = 'Download/update & set up the configuration file(s) to be loaded by the shell environment'
  c.example "Downloads https://github.com/mkwmms/fish-osx to " \
    "#{Dotstrap.dotstrap_config_home}/mkwmms-fish-osx", 'dotstrap bundle mkwmms/fish-osx'
  c.option '--file FILE', String, 'Read Github repo slugs from FILE'
  c.action do |args, options|
    if options.file
      File.open(options.file).each do |line|
        args << line.strip unless line.start_with?('#')
      end
    end
    Dotstrap::Configuration.new(args).configure
  end
end

command :remove do |c|
  c.syntax = 'dotstrap unbundle [options]'
  c.summary = 'Unbundle a specified GitHub repository'
  c.description = 'Removes the shell configuration file(s) and lines from the source file from the given repository'
  c.action do |args, options|
    Dotstrap::Configuration.new(args).remove
  end
end

command :list do |c|
  c.syntax = 'dotstrap list'
  c.summary = 'List file path and URL for currently bundled specified GitHub repository (or all if none specified)'
  c.action do |args, options|
    Dotstrap::Configuration.new(args).list
  end
end
