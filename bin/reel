#!/usr/bin/env ruby

# $bundle_PATH.push File.expand_path('../lib', __FILE__)

require 'reel'

program :version, Reel::VERSION
program :description, Reel::DESCRIPTION

program :help, 'Author', "#{Reel::AUTHOR} <#{Reel::EMAIL}>"
program :help, 'Website', Reel::HOMEPAGE
program :help_formatter, :compact

command :bundle do |c|
  c.syntax = 'reel bundle [options]'
  c.summary = 'Bundle a specified GitHub repository'
  c.description = 'Download/update & set up the configuration file(s) to be loaded by the shell environment'
  c.example "Downloads https://github.com/mkwmms/fish-osx to " \
    "#{Reel.reel_config_home}/mkwmms-fish-osx", 'reel bundle mkwmms/fish-osx'
  c.option '--file FILE', String, 'Read Github repo slugs from FILE'
  c.action do |args, options|
    if options.file
      File.open(options.file).each do |line|
        args << line.strip unless line.start_with?('#')
      end
    end
    bundle = Reel::Bundle.new(args)
    bundle.download(args)
    bundle.load_configs(args)
  end
end

command :unbundle do |c|
  c.syntax = 'reel unbundle [options]'
  c.summary = 'Unbundle a specified GitHub repository'
  c.description = 'Removes the shell configuration file(s) and lines from the source file from the given repository'
  c.action do |args, options|
    bundle = Reel::Bundle.new(args)
    bundle.remove(args)
  end
end

command :list do |c|
  c.syntax = 'reel list'
  c.summary = 'List file path and URL for currently bundled specified GitHub repository (or all if none specified)'
  c.action do |args, options|
    bundle = Reel::Bundle.new(args)
    bundle.list(args)
  end
end
